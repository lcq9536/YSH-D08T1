C51 COMPILER V9.54   MAIN                                                                  12/17/2024 20:27:56 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Source\main.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\TouchKey) DEBUG PRI
                    -NT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <intrins.h>
   2          #include <SH79F3212.h>
   3          
   4          #include "Buzzer.h"
   5          #include "Voltage.h"
   6          #include "Triac.h"
   7          #include "NTC.h"
   8          #include "Key.h"
   9          #include "LED.h"
  10          #include "Timer.h"
  11          #include "Work.h"
  12          #include "tk.h"
  13          #include "MCU.h"
  14          #include "Digital.h"
  15          
  16          bool Flag = false;      //      LED和数码管分时共用
  17          bool ErrorFlag = true;  //      异常标志位
  18          
  19          unsigned char Sys_Count = 0;    //      系统计时
  20          unsigned char Sys_State = 0;    //      状态机选择位
  21          
  22          unsigned char FlashCount = 0;   //      数码管闪烁计数
  23          unsigned char ErrorCount = 0;   //      错误计数
  24          
  25          
  26          void main()
  27          {
  28   1              MCU_Init();
  29   1              Timer0_Init();
  30   1              InitKey();
  31   1              BuzzerSet(1,1000,300);
  32   1              LedSet(2,0x7f,0xff);
  33   1              DigitalSet(24,24,24);
  34   1              while(1)
  35   1              {
  36   2                      RSTSTAT = 0x02;
  37   2                      
  38   2                      if(Sys_Count >= 15)
  39   2                      {
  40   3                              Sys_Count = 0;
  41   3                              
  42   3                              Sys_State ++;
  43   3                              if(Sys_State >= 10) Sys_State = 0;
  44   3                              
  45   3                              tkRound();
  46   3                              
  47   3                              switch(Sys_State)
  48   3                              {
  49   4                                      case 1:
  50   4                                              ADCON = 0;      //      关闭ADC
  51   4                                              ADC2H = 0;      //      P3.3作为普通IO口
  52   4                                              Buzzer(Buzzer_Times,Buzzer_Interval,Buzzer_Duration);
  53   4                                      break;
  54   4                                      
C51 COMPILER V9.54   MAIN                                                                  12/17/2024 20:27:56 PAGE 2   

  55   4                                      case 2:
  56   4                                              Get_KeyValue(KeyRead);  //      判断键值
  57   4                                              Key_Handle();   //      键值处理
  58   4                                      break;
  59   4                                      
  60   4                                      case 3:
  61   4                                              if(Buzzer_State != 1)
  62   4                                              {
  63   5                                                      AD_Value = ADC_Read();
  64   5                                                      AD_Deal(AD_Value);
  65   5                                                      Temperature = AD_To_Temperature(AD_Value);
  66   5                                                      Temperature_Deal(Temperature);
  67   5                                              }
  68   4                                      break;
  69   4                                              
  70   4                                      case 4: 
  71   4                                              StandbyMode();  //      待机状态
  72   4                                      break;
  73   4                                              
  74   4                                      case 5:
  75   4                                              CheckMode();    //      自检状态
  76   4                                      break;
  77   4                                              
  78   4                                      case 6: //报警状态
  79   4                                              FlashCount ++;
  80   4                                              if(FlashCount >= 50) FlashCount = 0;
  81   4                                              
  82   4                                              if(Buzzer_State != 1)
  83   4                                              {
  84   5                                                      if(AD_Value < 80)       //      短路195℃
  85   5                                                      {
  86   6                                                              ErrorCount ++;
  87   6                                                              if(ErrorCount > 25)
  88   6                                                              {
  89   7                                                                      ErrorCount = 0;
  90   7                                                                      Sys_Mode = 3;
  91   7                                                                      
  92   7                                                                      LedSet(0,0x00,0);
  93   7                                                                      BuzzerSet(3,300,300);
  94   7                                                                      TriacSet(0,0,0,0);
  95   7                                                                      
  96   7                                                                      if(FlashCount < 25) DigitalSet(21,0,1); //      E01
  97   7                                                                      else DigitalSet(23,23,23);
  98   7                                                              }
  99   6                                                      }
 100   5                                                      if(Sys_Mode == 5 && AD_Value < 100)     //      干烧185℃
 101   5                                                      {
 102   6                                                              ErrorCount ++;
 103   6                                                              if(ErrorCount > 25)
 104   6                                                              {
 105   7                                                                      ErrorCount = 0;
 106   7                                                                      Sys_Mode = 3;   //      报警状态
 107   7                                                                      if(ErrorFlag)
 108   7                                                                      {
 109   8                                                                              ErrorFlag = false;
 110   8                                                                              LedSet(0,0x00,0);
 111   8                                                                              BuzzerSet(3,300,300);
 112   8                                                                              TriacSet(0,0,0,0);
 113   8                                                                      }
 114   7                                                                      if(FlashCount < 25) DigitalSet(21,0,0); //E00
 115   7                                                                      else DigitalSet(23,23,23);
 116   7                                                              }
C51 COMPILER V9.54   MAIN                                                                  12/17/2024 20:27:56 PAGE 3   

 117   6                                                      }
 118   5                                                      else if(AD_Value > 3965)        //开路-20℃
 119   5                                                      {
 120   6                                                              ErrorCount ++;
 121   6                                                              if(ErrorCount > 25)
 122   6                                                              {
 123   7                                                                      ErrorCount = 0;
 124   7                                                                      Sys_Mode = 3;
 125   7                                                                      if(ErrorFlag)
 126   7                                                                      {
 127   8                                                                              ErrorFlag = false;
 128   8                                                                              LedSet(0,0x00,0);
 129   8                                                                              BuzzerSet(3,300,300);
 130   8                                                                              TriacSet(0,0,0,0);
 131   8                                                                      }
 132   7                                                                      
 133   7                                                                      if(FlashCount < 25) DigitalSet(10,0,0); //      000
 134   7                                                                      else if(FlashCount >= 25) DigitalSet(23,23,23);
 135   7                                                              }
 136   6                                                      }
 137   5                                                      if(Sys_Mode == 3 && AD_Value > 709 && AD_Value < 3530)
 138   5                                                      {
 139   6                                                              NTCOpen = false;
 140   6                                                              NTCShort = false;
 141   6                                                              DryBoil = false;
 142   6                                                              ErrorFlag = true;
 143   6                                                              Sys_Mode = 1;   //      切换待机状态
 144   6                                                      }
 145   5                                              }
 146   4                                      break;
 147   4                              }
 148   3                      }
 149   2              }
 150   1      }
 151          
 152          /**
 153            * @Brief      中断服务函数
 154            * @Param  None
 155            * @Note   通过中断向量表进入
 156            * @RetVal     None
 157            */
 158          void timer0() interrupt 1
 159          {
 160   1              TL0             = 0xe3;
 161   1              TH0             = 0xf7;
 162   1              
 163   1              TF0 = 0;        // 清除中断标志位
 164   1              
 165   1              Sys_Count ++;
 166   1              
 167   1              // 蜂鸣部分
 168   1              if(Buzzer_State == 1)
 169   1              {
 170   2                      BUZZER = !BUZZER;
 171   2              }
 172   1              
 173   1              // 可控硅部分
 174   1              Triac_SkipCycles(On_Time,Off_Time,Skip_Cycles,Total_Cycles);
 175   1              
 176   1              // 显示部分
 177   1              Flag = !Flag;
 178   1              if(!Flag)
C51 COMPILER V9.54   MAIN                                                                  12/17/2024 20:27:56 PAGE 4   

 179   1              {
 180   2                      Led_Display(LED_State,LED_Value,LED_Time);
 181   2              }
 182   1              else
 183   1              {
 184   2                      Digital_Display(Digital_Num1,Digital_Num2,Digital_Num3);
 185   2              }
 186   1      }
 187          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    631    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
