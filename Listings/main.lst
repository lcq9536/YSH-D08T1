C51 COMPILER V9.54   MAIN                                                                  12/16/2024 19:37:50 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Source\main.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\TouchKey) DEBUG PRI
                    -NT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <intrins.h>
   2          #include <SH79F3212.h>
   3          
   4          #include "Buzzer.h"
   5          #include "Voltage.h"
   6          #include "Triac.h"
   7          #include "NTC.h"
   8          #include "Key.h"
   9          #include "LED.h"
  10          #include "Timer.h"
  11          #include "tk.h"
  12          #include "MCU.h"
  13          #include "Digital.h"
  14          
  15          bool Flag = false;      //      LED和数码管分时共用
  16          
  17          unsigned char Sys_Count = 0;    //      系统计时
  18          unsigned char Sys_State = 0;    //      状态机选择位
  19          
  20          //      系统状态:0-上电状态、1-待机状态、2-自检状态、3-报警状态、4-选择状态、5-工作状态
  21          unsigned char Sys_Mode = 0;
  22          
  23          unsigned int PowerOnCount = 0;  //      上电计数
  24          
  25          void main()
  26          {
  27   1              MCU_Init();
  28   1              Timer0_Init();
  29   1              InitKey();
  30   1              BuzzerSet(1,1000,300);
  31   1              LedSet(1,0x7f,1000);
  32   1              DigitalSet(23,23,23);
  33   1              while(1)
  34   1              {
  35   2                      RSTSTAT = 0x02;
  36   2                      
  37   2                      if(Sys_Count >= 15)
  38   2                      {
  39   3                              Sys_Count = 0;
  40   3                              
  41   3                              Sys_State ++;
  42   3                              if(Sys_State >= 10) Sys_State = 0;
  43   3                              
  44   3                              tkRound();
  45   3                              
  46   3                              switch(Sys_State)
  47   3                              {
  48   4                                      case 1:
  49   4                                              ADCON = 0;      //      关闭ADC
  50   4                                              ADC2H = 0;      //      P3.3作为普通IO口
  51   4                                              Buzzer(Buzzer_Times,Buzzer_Interval,Buzzer_Duration);
  52   4                                      break;
  53   4                                      
  54   4                                      case 2:
C51 COMPILER V9.54   MAIN                                                                  12/16/2024 19:37:50 PAGE 2   

  55   4                                              Get_KeyValue(KeyRead);  //      判断键值
  56   4                                              Key_Handle();   //      键值处理
  57   4                                      break;
  58   4                                      
  59   4                                      case 3:
  60   4                                              if(Buzzer_State != 1)
  61   4                                              {
  62   5                                                      AD_Value = ADC_Read();
  63   5                                                      AD_Deal(AD_Value);
  64   5                                                      Temperature = AD_To_Temperature(AD_Value);
  65   5                                                      Temperature_Deal(Temperature);
  66   5                                                      //DigitalSet(Temperature/10%10,Temperature%10+10,20);
  67   5                                              }
  68   4                                      break;
  69   4                                              
  70   4                                      case 4:
  71   4                                              if(PowerOnCount > 7999 || Sys_Mode == 1)
  72   4                                              {
  73   5                                                      DigitalSet(0+10,0,0);
  74   5                                                      LedSet(0,0x00,0);
  75   5                                                      BuzzerSet(0,0,0);
  76   5                                                      TriacSet(0,0,0,0);
  77   5                                                      if(KeyValue == 0x01)
  78   5                                                      {
  79   6                                                              Sys_Mode = 2;
  80   6                                                      }
  81   5                                              }
  82   4                                      break;
  83   4                                              
  84   4                                      case 5:
  85   4      //                                      if(PowerOnCount < 31999)
  86   4      //                                      {
  87   4      //                                              PowerOnCount = 32000;
  88   4      //                                              if(KeyValue == 0x03)
  89   4      //                                              {
  90   4      //                                                      if(KeyCount == 80 - 2)
  91   4      //                                                      {
  92   4      //                                                              BuzzerSet(2,100,100);
  93   4      //                                                      }
  94   4      //                                              }
  95   4      //                                      }
  96   4                                      break;
  97   4                              }
  98   3                      }
  99   2              }
 100   1      }
 101          
 102          /**
 103            * @Brief      中断服务函数
 104            * @Param  None
 105            * @Note   通过中断向量表进入
 106            * @RetVal     None
 107            */
 108          void timer0() interrupt 1
 109          {
 110   1              TL0             = 0xe3;
 111   1              TH0             = 0xf7;
 112   1              
 113   1              TF0 = 0;        // 清除中断标志位
 114   1              
 115   1              Sys_Count ++;
 116   1              
C51 COMPILER V9.54   MAIN                                                                  12/16/2024 19:37:50 PAGE 3   

 117   1              PowerOnCount ++;
 118   1              
 119   1              // 蜂鸣部分
 120   1              if(Buzzer_State == 1)
 121   1              {
 122   2                      BUZZER = !BUZZER;
 123   2              }
 124   1              
 125   1              // 可控硅部分
 126   1              Triac_SkipCycles(On_Time,Off_Time,Skip_Cycles,Total_Cycles);
 127   1              
 128   1              // 显示部分
 129   1              Flag = !Flag;
 130   1              if(!Flag)
 131   1              {
 132   2                      Led_Display(LED_State,LED_Value,LED_Time);
 133   2              }
 134   1              else
 135   1              {
 136   2                      Digital_Display(Digital_Num1,Digital_Num2,Digital_Num3);
 137   2              }
 138   1      }
 139          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    354    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
