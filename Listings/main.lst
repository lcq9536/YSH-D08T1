C51 COMPILER V9.54   MAIN                                                                  12/17/2024 10:44:23 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Source\main.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\TouchKey) DEBUG PRI
                    -NT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <intrins.h>
   2          #include <SH79F3212.h>
   3          
   4          #include "Buzzer.h"
   5          #include "Voltage.h"
   6          #include "Triac.h"
   7          #include "NTC.h"
   8          #include "Key.h"
   9          #include "LED.h"
  10          #include "Timer.h"
  11          #include "tk.h"
  12          #include "MCU.h"
  13          #include "Digital.h"
  14          
  15          bool Flag = false;      //      LED和数码管分时共用
  16          bool Scroll_Flag = false;
  17          
  18          unsigned char Sys_Count = 0;    //      系统计时
  19          unsigned char Sys_State = 0;    //      状态机选择位
  20          
  21          //      系统状态:0-上电状态、1-待机状态、2-自检状态、3-报警状态、4-选择状态、5-工作状态
  22          unsigned char Sys_Mode = 1;
  23          
  24          unsigned int PowerOnCount1 = 0; //      上电计数
  25          unsigned int PowerOnCount2 = 0; //      上电计数
  26          
  27          unsigned int xdata ScrollData[11][3] = {
  28                  {10,0,0},{11,1,1},{12,2,2},{13,3,3},{14,4,4},{15,5,5},
  29                  {16,6,6},{17,7,7},{18,8,8},{19,9,9},{21,0,0}
  30          };
  31          unsigned char ScrollPos = 0;    //      数码管轮播索引
  32          unsigned int ScrollCounter = 0; //      数码管轮播计数
  33          
  34          void main()
  35          {
  36   1              MCU_Init();
  37   1              Timer0_Init();
  38   1              InitKey();
  39   1              BuzzerSet(1,1000,300);
  40   1              LedSet(2,0x7f,0xff);
  41   1              DigitalSet(23,23,23);
  42   1              while(1)
  43   1              {
  44   2                      RSTSTAT = 0x02;
  45   2                      
  46   2                      if(Sys_Count >= 15)
  47   2                      {
  48   3                              Sys_Count = 0;
  49   3                              
  50   3                              Sys_State ++;
  51   3                              if(Sys_State >= 10) Sys_State = 0;
  52   3                              
  53   3                              tkRound();
  54   3                              
C51 COMPILER V9.54   MAIN                                                                  12/17/2024 10:44:23 PAGE 2   

  55   3                              switch(Sys_State)
  56   3                              {
  57   4                                      case 1:
  58   4                                              ADCON = 0;      //      关闭ADC
  59   4                                              ADC2H = 0;      //      P3.3作为普通IO口
  60   4                                              Buzzer(Buzzer_Times,Buzzer_Interval,Buzzer_Duration);
  61   4                                      break;
  62   4                                      
  63   4                                      case 2:
  64   4                                              Get_KeyValue(KeyRead);  //      判断键值
  65   4                                              Key_Handle();   //      键值处理
  66   4                                      break;
  67   4                                      
  68   4                                      case 3:
  69   4                                              if(Buzzer_State != 1)
  70   4                                              {
  71   5                                                      AD_Value = ADC_Read();
  72   5                                                      AD_Deal(AD_Value);
  73   5                                                      Temperature = AD_To_Temperature(AD_Value);
  74   5                                                      Temperature_Deal(Temperature);
  75   5                                              }
  76   4                                      break;
  77   4                                              
  78   4                                      case 4: //      待机状态
  79   4                                              PowerOnCount1 ++;
  80   4                                              if(PowerOnCount1 > 49 && Sys_Mode == 1)
  81   4                                              {
  82   5                                                      PowerOnCount1 = 8000;
  83   5                                                      DigitalSet(10,0,0);
  84   5                                                      LedSet(0,0x00,0);
  85   5                                                      BuzzerSet(0,0,0);
  86   5                                                      TriacSet(0,0,0,0);
  87   5                                                      if(KeyValue == 0x01)
  88   5                                                      {
  89   6                                                              Sys_Mode = 2;
  90   6                                                      }
  91   5                                              }
  92   4                                      break;
  93   4                                              
  94   4                                      case 5: //      自检状态
  95   4                                              PowerOnCount2 ++;
  96   4                                              if(PowerOnCount2 < 199)
  97   4                                              {
  98   5                                                      if(KeyValue == 0x03)
  99   5                                                      {
 100   6                                                              Sys_Mode = 2;   //      自检状态
 101   6                                                              if(KeyCount == 80 - 2)
 102   6                                                              {
 103   7                                                                      BuzzerSet(2,100,100);
 104   7                                                                      TriacSet(4,6,0,10);
 105   7                                                                      DigitalSet(10,0,0);
 106   7                                                                      Scroll_Flag = true;     //      开启数码管轮播
 107   7                                                              }
 108   6                                                      }
 109   5                                              }
 110   4                                              else PowerOnCount2 = 200;
 111   4                                              
 112   4                                              if(Scroll_Flag)
 113   4                                              {
 114   5                                                      ScrollCounter ++;
 115   5                                                      if(ScrollCounter > 49)
 116   5                                                      {
C51 COMPILER V9.54   MAIN                                                                  12/17/2024 10:44:23 PAGE 3   

 117   6                                                              ScrollCounter = 0;
 118   6                                                              ScrollPos ++;
 119   6                                                              if(ScrollPos < 11)
 120   6                                                              {
 121   7                                                                      DigitalSet(ScrollData[ScrollPos][0],
 122   7                                                                              ScrollData[ScrollPos][1],ScrollData[ScrollPos][2]);
 123   7                                                              }
 124   6                                                              else if(ScrollPos == 11)
 125   6                                                              {
 126   7                                                                      DigitalSet(Temperature/10%10,Temperature%10+10,20);
 127   7                                                              }
 128   6                                                              else
 129   6                                                              {
 130   7                                                                      ScrollPos = 0;
 131   7                                                                      Sys_Mode = 1;   //      切换待机状态
 132   7                                                                      Scroll_Flag = 0;        //      关闭轮播
 133   7                                                              }
 134   6                                                      }
 135   5                                              }
 136   4                                      break;
 137   4                              }
 138   3                      }
 139   2              }
 140   1      }
 141          
 142          /**
 143            * @Brief      中断服务函数
 144            * @Param  None
 145            * @Note   通过中断向量表进入
 146            * @RetVal     None
 147            */
 148          void timer0() interrupt 1
 149          {
 150   1              TL0             = 0xe3;
 151   1              TH0             = 0xf7;
 152   1              
 153   1              TF0 = 0;        // 清除中断标志位
 154   1              
 155   1              Sys_Count ++;
 156   1              
 157   1              // 蜂鸣部分
 158   1              if(Buzzer_State == 1)
 159   1              {
 160   2                      BUZZER = !BUZZER;
 161   2              }
 162   1              
 163   1              // 可控硅部分
 164   1              Triac_SkipCycles(On_Time,Off_Time,Skip_Cycles,Total_Cycles);
 165   1              
 166   1              // 显示部分
 167   1              Flag = !Flag;
 168   1              if(!Flag)
 169   1              {
 170   2                      Led_Display(LED_State,LED_Value,LED_Time);
 171   2              }
 172   1              else
 173   1              {
 174   2                      Digital_Display(Digital_Num1,Digital_Num2,Digital_Num3);
 175   2              }
 176   1      }
 177          

C51 COMPILER V9.54   MAIN                                                                  12/17/2024 10:44:23 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    604    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     66    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
